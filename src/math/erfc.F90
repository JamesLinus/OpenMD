! **********************************************************************
!     erfc.F used with permission from Naval Surface Warfare Group
!******************************************************************************
function erfc (x)

  use definitions

  !! ERFC: the complementary error function
  
  real( kind = DP ) :: erfc
  real( kind = DP ) :: an, ax, c, eps, rpinv, t, x, w
  real( kind = DP ) :: a(21), b(44), e(44)
  real( kind = DP ) :: dpmpar, dcsevl
  !
  !     rpinv = 1/sqrt(pi)
  !
  data rpinv /.56418958354775628694807945156077259e0_dp/
  !
  data a(1)  / .1283791670955125738961589031215e+00_dp/, &
       a(2)  /-.3761263890318375246320529677070e+00_dp/, &
       a(3)  / .1128379167095512573896158902931e+00_dp/, &
       a(4)  /-.2686617064513125175943235372542e-01_dp/, &
       a(5)  / .5223977625442187842111812447877e-02_dp/, &
       a(6)  /-.8548327023450852832540164081187e-03_dp/, &
       a(7)  / .1205533298178966425020717182498e-03_dp/, &
       a(8)  /-.1492565035840625090430728526820e-04_dp/, &
       a(9)  / .1646211436588924261080723578109e-05_dp/, &
       a(10) /-.1636584469123468757408968429674e-06_dp/
  data a(11) / .1480719281587021715400818627811e-07_dp/, &
       a(12) /-.1229055530145120140800510155331e-08_dp/, &
       a(13) / .9422759058437197017313055084212e-10_dp/, &
       a(14) /-.6711366740969385085896257227159e-11_dp/, &
       a(15) / .4463222608295664017461758843550e-12_dp/, &
       a(16) /-.2783497395542995487275065856998e-13_dp/, &
       a(17) / .1634095572365337143933023780777e-14_dp/, &
       a(18) /-.9052845786901123985710019387938e-16_dp/, &
       a(19) / .4708274559689744439341671426731e-17_dp/, &
       a(20) /-.2187159356685015949749948252160e-18_dp/, &
       a(21) / .7043407712019701609635599701333e-20_dp/
  !
  data b(1)  / .610143081923200417926465815756e+00_dp/, &
       b(2)  /-.434841272712577471828182820888e+00_dp/, &
       b(3)  / .176351193643605501125840298123e+00_dp/, &
       b(4)  /-.607107956092494148600512158250e-01_dp/, &
       b(5)  / .177120689956941144861471411910e-01_dp/, &
       b(6)  /-.432111938556729381859986496800e-02_dp/, &
       b(7)  / .854216676887098678819832055000e-03_dp/, &
       b(8)  /-.127155090609162742628893940000e-03_dp/, &
       b(9)  / .112481672436711894688470720000e-04_dp/, &
       b(10) / .313063885421820972630152000000e-06_dp/
  data b(11) /-.270988068537762022009086000000e-06_dp/, &
       b(12) / .307376227014076884409590000000e-07_dp/, &
       b(13) / .251562038481762293731400000000e-08_dp/, &
       b(14) /-.102892992132031912759000000000e-08_dp/, &
       b(15) / .299440521199499393630000000000e-10_dp/, &
       b(16) / .260517896872669362900000000000e-10_dp/, &
       b(17) /-.263483992417196938600000000000e-11_dp/, &
       b(18) /-.643404509890636443000000000000e-12_dp/, &
       b(19) / .112457401801663447000000000000e-12_dp/, &
       b(20) / .172815333899860980000000000000e-13_dp/
  data b(21) /-.426410169494237500000000000000e-14_dp/, &
       b(22) /-.545371977880191000000000000000e-15_dp/, &
       b(23) / .158697607761671000000000000000e-15_dp/, &
       b(24) / .208998378443340000000000000000e-16_dp/, &
       b(25) /-.590052686940900000000000000000e-17_dp/, &
       b(26) /-.941893387554000000000000000000e-18_dp/, &
       b(27) / .214977356470000000000000000000e-18_dp/, &
       b(28) / .466609850080000000000000000000e-19_dp/, &
       b(29) /-.724301186200000000000000000000e-20_dp/, &
       b(30) /-.238796682400000000000000000000e-20_dp/
  data b(31) / .191177535000000000000000000000e-21_dp/, &
       b(32) / .120482568000000000000000000000e-21_dp/, &
       b(33) /-.672377000000000000000000000000e-24_dp/, &
       b(34) /-.574799700000000000000000000000e-23_dp/, &
       b(35) /-.428493000000000000000000000000e-24_dp/, &
       b(36) / .244856000000000000000000000000e-24_dp/, &
       b(37) / .437930000000000000000000000000e-25_dp/, &
       b(38) /-.815100000000000000000000000000e-26_dp/, &
       b(39) /-.308900000000000000000000000000e-26_dp/, &
       b(40) / .930000000000000000000000000000e-28_dp/
  data b(41) / .174000000000000000000000000000e-27_dp/, &
       b(42) / .160000000000000000000000000000e-28_dp/, &
       b(43) /-.800000000000000000000000000000e-29_dp/, &
       b(44) /-.200000000000000000000000000000e-29_dp/
  !
  data e(1)  / .107797785207238315116833591035e+01_dp/, &
       e(2)  /-.265598904091486733721465009040e-01_dp/, &
       e(3)  /-.148707314669809950960504633300e-02_dp/, &
       e(4)  /-.138040145414143859607708920000e-03_dp/, &
       e(5)  /-.112803033322874914985073660000e-04_dp/, &
       e(6)  /-.117286984274372522405373900000e-05_dp/, &
       e(7)  /-.103476150393304615537382000000e-06_dp/, &
       e(8)  /-.118991140858924382544470000000e-07_dp/, &
       e(9)  /-.101622254498949864047600000000e-08_dp/, &
       e(10) /-.137895716146965692169000000000e-09_dp/
  data e(11) /-.936961303373730333500000000000e-11_dp/, &
       e(12) /-.191880958395952534900000000000e-11_dp/, &
       e(13) /-.375730172019937070000000000000e-13_dp/, &
       e(14) /-.370537260269833570000000000000e-13_dp/, &
       e(15) / .262756542349037100000000000000e-14_dp/, &
       e(16) /-.112132287643793300000000000000e-14_dp/, &
       e(17) / .184136028922538000000000000000e-15_dp/, &
       e(18) /-.491302565748860000000000000000e-16_dp/, &
       e(19) / .107044551673730000000000000000e-16_dp/, &
       e(20) /-.267189366240500000000000000000e-17_dp/
  data e(21) / .649326867976000000000000000000e-18_dp/, &
       e(22) /-.165399353183000000000000000000e-18_dp/, &
       e(23) / .426056266040000000000000000000e-19_dp/, &
       e(24) /-.112558407650000000000000000000e-19_dp/, &
       e(25) / .302561744800000000000000000000e-20_dp/, &
       e(26) /-.829042146000000000000000000000e-21_dp/, &
       e(27) / .231049558000000000000000000000e-21_dp/, &
       e(28) /-.654695110000000000000000000000e-22_dp/, &
       e(29) / .188423140000000000000000000000e-22_dp/, &
       e(30) /-.550434100000000000000000000000e-23_dp/
  data e(31) / .163095000000000000000000000000e-23_dp/, &
       e(32) /-.489860000000000000000000000000e-24_dp/, &
       e(33) / .149054000000000000000000000000e-24_dp/, &
       e(34) /-.459220000000000000000000000000e-25_dp/, &
       e(35) / .143180000000000000000000000000e-25_dp/, &
       e(36) /-.451600000000000000000000000000e-26_dp/, &
       e(37) / .144000000000000000000000000000e-26_dp/, &
       e(38) /-.464000000000000000000000000000e-27_dp/, &
       e(39) / .151000000000000000000000000000e-27_dp/, &
       e(40) /-.500000000000000000000000000000e-28_dp/
  data e(41) / .170000000000000000000000000000e-28_dp/, &
       e(42) /-.600000000000000000000000000000e-29_dp/, &
       e(43) / .200000000000000000000000000000e-29_dp/, &
       e(44) /-.100000000000000000000000000000e-29_dp/
  !
  eps = epsilon ( eps )
  !
  !                     abs(x) <= 1
  !
  ax = abs(x)
  if (ax > 1.0_dp) go to 20
  t = x*x
  w = a(21)
  do i = 1,20
     k = 21 - i
     w = t*w + a(k)
  end do
  erfc = 0.5_dp + (0.5_dp - x*(1.0_dp + w))
  return
  !
  !                  1 < abs(x)  <  2
  !
20 if (ax >= 2.0_dp) go to 30
  n = 44
  if (eps >= 1.0e-20_dp) n = 30
  t = (ax - 3.75_dp)/(ax + 3.75_dp)
  erfc = csevl(t, b, n)
21 erfc = exp(-x*x) * erfc
  if (x < 0.0_dp) erfc = 2.0_dp - erfc
  return
  !
  !                  2 < dabs(x)  <  12
  !
30 if (x < -9.0_dp) go to 60
  if (x >= 12.0_dp) go to 40
  n = 44
  if (eps >= 1.0e-20_dp) n = 25
  t = (1.0_dp/x)**2
  w = (10.5_dp*t - 1.0_dp)/(2.5_dp*t + 1.0_dp)
  erfc = csevl(w, e, n) / ax
  go to 21
  !
  !                       x >= 12
  !
40 if (x > 50.0_dp) go to 70
  t = (1.0_dp/x)**2
  an = -0.5_dp
  c  =  0.5_dp
  w  =  0.0_dp
50 c = c + 1.0_dp
  an = - c*an*t
  w = w + an
  if (abs(an) > eps) go to 50
  w = (-0.5_dp + w)*t + 1.0_dp
  erfc = exp(-x*x) * ((rpinv*w)/ax)
  return
  !
  !             limit value for large negative x
  !
60 erfc = 2.0_dp
  return
  !
  !             limit value for large positive x
  !
70 erfc = 0.0_dp
  return
end function erfc
  
function csevl (x, a, n)

  !! CSEVL: evaluate the n term chebyshev series a at x.
  !!         only half of the first coefficient is used.
  
  use definitions
  
  real( kind = DP ) :: csevl
  real( kind = DP ) :: a(n), x, x2, s0, s1, s2
  
  if (n .le. 1) then
     csevl = 0.5_dp * a(1)
     return
  else
     
     x2 = x + x
     s0 = a(n)
     s1 = 0.0_dp
     do i = 2,n
        s2 = s1
        s1 = s0
        k = n - i + 1
        s0 = x2*s1 - s2 + a(k)
     end do
     csevl = 0.5_dp * (s0 - s2)
     return
     
  endif
end function csevl
